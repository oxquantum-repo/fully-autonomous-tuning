experiment_name = "20231130_barrier_volume_to_rabi_gate_set_C"
gate_set_name = 'C'

[RootStage]

    bias_directions = ['positive_bias', 'negative_bias']
    barrier_locs_list = [[1.35745229, 0.69054827, 1.03886697],
       [1.37047139, 0.79571152, 1.01152746],
       [1.33650958, 0.68988835, 0.91359629],
       [1.35364427, 0.78143482, 0.93984951],
       [1.33838181, 0.78802731, 0.95418942],
       [1.34811755, 0.79186732, 0.94927037],
       [1.37795139, 0.71063425, 1.01945835],
       [1.3509234 , 0.64578935, 0.99796691],
       [1.33799998, 0.80699998, 1.02053926],
       [1.32192042, 0.76579382, 0.89495363],
       [1.33075702, 0.65063999, 0.96562248]]
        major_axis_poff = [1.4009999999999863, 0.8430000000000006, 1.073999999999998]
        major_axis_poff_new_set = [0.7980000000000006, 1.0619999999999985, 2.985000000000002]
        bias_voltage = 0.005

[PSBViaWideScan]
    low_magnetic_field= 0.0
    high_magnetic_field= 0.1

    psb_threshold = 0.5
    psb_model = 'lenet'
    offset_px = 10
    max_number_candidates = 3

    folder_path_to_nn = "../signal_processing/psb_classifier/saved_networks/20230830_lenet_all_real_data_nanowire_low_res/"
    network_names = 'all_real_data'

    padding = 0.03
left_plunger_voltage = 0
right_plunger_voltage = 0
    window_right_plunger = 0.3
    window_left_plunger = 0.3
    resolution =0.002
   wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777
    force_analysis= false
    force_measurement = false

   [PSBViaWideScan.invert_current]
        positive_bias = true
        negative_bias = false
   [PSBViaWideScan.separation_scoring]
        segmentation_upscaling_res =2
        relative_min_area = 0.01
        denoising = true
        allow_MET = false
        thr_method = 'triangle'


[ReCenteringStage]
    magnetic_field= 0.1

    resolution = 0.002#0.001
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777

    segmentation_upscaling_res =2
    relative_min_area = 0.01
    denoising = true
    allow_MET = false
    thr_method = 'triangle'

    force_analysis= false
    force_measurement = false

    [ReCenteringStage.invert_current]
        positive_bias = true
        negative_bias = false

[HighResPSBClassifier]
    low_magnetic_field= 0.0
    high_magnetic_field= 0.1

    resolution = 0.00075#0.001
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777

    # if using neural network
    psb_threshold = 0.5
    psb_model = 'resnet'

    padding = 0.005 # in V in total per dimension, so 0.01 means 0.005 on each side

    # if using segmentation (current standard)
    slope_tol = 0.4
    int_tol = 0.05
    seg_tol = 0.05
    median = false
    segmentation_upscaling_res =2
    relative_min_area = 0.01
    denoising = true
    allow_MET = false
    thr_method = 'triangle'
    force_analysis= false
    force_measurement = false

    [HighResPSBClassifier.invert_current]
        positive_bias = true
        negative_bias = false


[DanonGapCheck]

    magnetic_field_min = -0.1
    magnetic_field_max = 0.1
    resolution_magnet = 0.003

    resolution_detuning = 0.0001

    detuning_base_offset = 0.002

    extra_wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.077

    segmentation_upscaling_res =2

    min_area = 3
    thr_method = 'triangle'
    allow_MET = false
    padding_factor = 1
    minimum_det_line_length_ratio = 0.33
    peak_offset_tolerance = 0.025

    force_measurement = false
    force_analysis = false
    [DanonGapCheck.detector]
        method = 'MF' # [OU, MF]
        sigma = 1

        # OU settings
        prominence = 0.5
        min_kernel_size=3
        max_kernel_size=21
        prior_n=4
        detection_threshold=0.85

        # MF settings
        field_gap_size = 0.002
        relative_depth = 1.0

    # Determines how the candidates for the next stage are built
#    [DanonGapCheck.HighResLowMagnet]
#        magnetic_field_min = 0.0
#        magnetic_field_max = 0.100
#        resolution_magnet = 0.01 #0.0005#0.01
#    [DanonGapCheck.LowResHighMagnet]
#        magnetic_field_min = 0.09
#        magnetic_field_max = 0.5
#        resolution_magnet = 0.05#0.02#0.01

    [DanonGapCheck.invert_current]
        positive_bias = true
        negative_bias = false

[ReadoutViaBvsDetuning]
    freq_vs = 2.79e9

    force_analysis= false
    force_measurement = false

    resolution_detuning = 0.0002

    extra_wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.6#1.1#2.5

    lockin_tc = 0.5#1#2

    [ReadoutViaBvsDetuning.detector]
        method = "MF" # [OU, MF]
        sigma = 1

        # OU settings
        max_kernel_size=11
        prominence=0.5
        detection_threshold=0.85

        # MF settings
        circularity_thresh = 3
        relative_length = 0.3
        adaptive_window = 7



[RabiAndEDSR]
    freq_vs = 2.79e9
    force_analysis= false
    force_measurement = false

    [RabiAndEDSR.Rabi]
        magnetic_field_window_multiplier = 2 # window is determined by EDSRCheck and multiplied with this number
        #resolution_magnet = 0.002
        n_px_magnet = 40

        resolution_burst_time = 1e-9

        min_burst_time = 0
        max_burst_time = 45e-9
        dead_burst_time = 10e-9



        extra_wait_time_slow_axis = 0.5
        wait_time_fast_axis = 2.5

        lockin_tc = 2

    [RabiAndEDSR.EDSR]
        min_magnetic_field = 0
        max_magnetic_field = 0.5
        resolution_magnet = 0.01

        min_freq_vs = 1.5e9
        max_freq_vs = 3.5e9

        resolution_freq = 0.5e8

        extra_wait_time_slow_axis = 2
        wait_time_fast_axis = 1.1#2.5

        lockin_tc = 1#2

[EDSRline]
    force_analysis= false
    force_measurement = false

    min_magnetic_field = 0
    max_magnetic_field = 0.5
    resolution_magnet = 0.01

    min_freq_vs = 2e9
    max_freq_vs = 3e9

    resolution_freq = 0.5e8

    extra_wait_time_slow_axis = 2
    wait_time_fast_axis = 1.1#2.5

    lockin_tc = 1#2

    sigma = 1

    circularity_thresh = 3
    relative_length = 0.3
    adaptive_window = 7

[Rabi]
    force_analysis= false
    force_measurement = false

    magnetic_field_window_multiplier = 2 # window is determined by EDSRCheck and multiplied with this number
    resolution_magnet = 0.00075
    n_px_magnet = 40

    resolution_burst_time = 1e-9

    min_burst_time = 0
    max_burst_time = 45e-9
    dead_burst_time = 10e-9



    extra_wait_time_slow_axis = 6
    wait_time_fast_axis = 2.5

    lockin_tc = 2

[RabiOscillations]
    force_analysis= false
    force_measurement = false

    resolution_burst_time = 0.5e-9

    min_burst_time = 0
    max_burst_time = 60e-9
    dead_burst_time = 10e-9

    lockin_tc = 2

    n_repetitions = 5


[EDSRCheck]
    freq_vs = 2.79e9

    magnetic_field_window = 0.1
    resolution_magnet = 0.001

    wait_time = 2.5

    lockin_tc = 2


    prominence = 0.9
    sigma = 1
    force_analysis= false
    force_measurement = false

    peak_offset_tolerance = 0.025
[EDSRCheck.switch_check_scan]
    resolution = 0.0015
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.051
[ReadoutOptim]
    magnetic_field = 0.1
    resolution = 0.00075
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777
    force_analysis = false
    force_measurement = false
    burst_time = 4e-9
    in_depth_search = false
    lockin_tc = 1
    padding = 0.005
    segmentation_upscaling_res = 2
    relative_min_area = 0.001
    thr_method = 'triangle'

    seeding = 15
    number_of_candidates = 3

[ReadoutOptim.score_config]
    name = "entropy"
    kwargs.rescale = true
# can use prominence instead
[ReadoutOptim.optim_pulse_params]
    freq_vs.minimum = 2.6e9
    freq_vs.maximum = 2.9e9
    burst_time_ns.minimum = 2
    burst_time_ns.maximum = 16


[ReadoutOptim.invert_current]
    positive_bias = true
    negative_bias = false

[ReadoutOptim.optimization_kwargs]
    iterations = 30

[ReadoutOptim.magnetic_field_scan_config]
    measure = ["X", "Y"]
    scan_kwargs.measurement_name = "readout_optim"

    [ReadoutOptim.magnetic_field_scan_config.domain]
        field_setpoint.start = 0.04
        field_setpoint.stop = 0.4

        field_setpoint.num_points = 300
        field_setpoint.delay = 1

# 100 mT per minute, 1.66mT/s
