#experiment_name = "20231206b_illustrative_measurements"
#experiment_name = "20231226_retaking_second_run_qubit"
#experiment_name = "20231228b_retaking_third_run_qubit"
#experiment_name = "20231227_retaking_fourth_run_qubit"
experiment_name = "20240222_check_qubit_7"
gate_set_name = 'A'

[RootStage]

    bias_voltage = 0.005

#    left_plunger_voltage = 0.0175
#    right_plunger_voltage = 0.00
#
#    left_barrier_voltage = 1.3704
#    middle_barrier_voltage = 0.795711
#    right_barrier_voltage = 1.0115
    left_plunger_voltage = 0.22
    right_plunger_voltage = -0.020

    left_barrier_voltage = 1.35
    middle_barrier_voltage = 0.660
    right_barrier_voltage = 1.02



#    bias_voltage = 0.005
#    left_plunger_voltage = 0.09
#    right_plunger_voltage = 0.08
#
#    left_barrier_voltage = 1.3383
#    middle_barrier_voltage = 0.7880
#    right_barrier_voltage = 0.95418

    force_analysis= false
    force_measurement = false

[PSBViaWideScan]
    max_number_candidates = 5

    low_magnetic_field= 0.0
    high_magnetic_field= 0.1

    window_right_plunger = 0.1
    window_left_plunger = 0.1

    folder_path_to_nn = "../signal_processing/psb_classifier/saved_networks/20230830_lenet_all_real_data_nanowire_low_res/"
    network_names = 'all_real_data'

    resolution = 0.002
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777

    psb_threshold = 0.0001#0.05
    psb_model = 'lenet'
    offset_px = 10

    force_analysis= true
    force_measurement = false
    [PSBViaWideScan.separation_scoring]
        segmentation_upscaling_res =2
        relative_min_area = 0.01
        denoising = true
        allow_MET = false
        thr_method = 'triangle'
   [PSBViaWideScan.invert_current]
        positive_bias = true
        negative_bias = false


[ReCenteringStage]
    magnetic_field= 0.1

    resolution = 0.002#0.001
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777

    segmentation_upscaling_res =2
    relative_min_area = 0.01
    denoising = true
    allow_MET = false
    thr_method = 'triangle'

    force_analysis= false
    force_measurement = false

    [ReCenteringStage.invert_current]
        positive_bias = true
        negative_bias = false

[HighResPSBClassifier]
    low_magnetic_field= 0.0
    high_magnetic_field= 0.1

    resolution = 0.00075#0.001
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777

    padding = 0.005 # in V in total per dimension, so 0.01 means 0.005 on each side

    # if using neural network
    psb_threshold = 0.5
    psb_model = 'resnet'
    classification_method = 'neural_network'
    # if using segmentation (current standard)
    slope_tol = 0.4
    int_tol = 0.05
    seg_tol = 0.05
    median = false
    segmentation_upscaling_res =2
    relative_min_area = 0.01
    denoising = true
    allow_MET = false
    thr_method = 'triangle'
    force_analysis= false
    force_measurement = false

    [HighResPSBClassifier.invert_current]
        positive_bias = true
        negative_bias = false

[DetuningLineDetermination]
    magnetic_field = 0.1
    resolution =0.00075#0.001
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777
    segmentation_upscaling_res =2

    relative_min_area = 0.001 #3
    thr_method = 'triangle'
    allow_MET = false
    denoising = false
    padding_factor=1
    force_analysis = false
    force_measurement = false
    minimum_det_line_length_ratio = 0.33
    burst_time = 4e-9
    in_depth_search = false

    [DetuningLineDetermination.invert_current]
        positive_bias = true
        negative_bias = false

[DetuningLineMsmt]
    base_offset_volts = 0.002
    magnetic_field = 0.1
    resolution = 0.0001
    wait_time_msmt = 0.0777
    force_analysis= false
    force_measurement = false
[DetuningLineMsmt.invert_current]
        positive_bias = true
        negative_bias = false

    burst_time = 4e-9
    in_depth_search = false
    [DetuningLineMsmt.in_depth_search]
        burst_times = [2e-9, 7e-9]

    [DetuningLineMsmt.HighResLowMagnet]
        magnetic_field_min = 0.0
        magnetic_field_max = 0.100
        resolution_magnet = 0.01#0.0005#0.01
    [DetuningLineMsmt.LowResHighMagnet]
        magnetic_field_min = 0.09
        magnetic_field_max = 0.5
        resolution_magnet = 0.01


[DanonGapCheck]

    magnetic_field_min = -0.1
    magnetic_field_max = 0.1
    resolution_magnet = 0.003

    resolution_detuning = 0.0001

    detuning_base_offset = 0.002

    extra_wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.077

    segmentation_upscaling_res =2

    min_area = 3
    thr_method = 'triangle'
    allow_MET = false
    padding_factor = 1
    minimum_det_line_length_ratio = 0.33
    peak_offset_tolerance = 0.02
    force_original_line = true
    force_measurement = false
    force_analysis = false
    [DanonGapCheck.detector]
        method = 'MF' # [OU, MF]
        sigma = 1

        # OU settings
        prominence = 0.5
        min_kernel_size=3
        max_kernel_size=21
        prior_n=4
        detection_threshold=0.85

        # MF settings
        field_gap_size = 0.002
        relative_depth = 1.0

    # Determines how the candidates for the next stage are built
#    [DanonGapCheck.HighResLowMagnet]
#        magnetic_field_min = 0.0
#        magnetic_field_max = 0.100
#        resolution_magnet = 0.01 #0.0005#0.01
#    [DanonGapCheck.LowResHighMagnet]
#        magnetic_field_min = 0.09
#        magnetic_field_max = 0.5
#        resolution_magnet = 0.05#0.02#0.01

    [DanonGapCheck.invert_current]
        positive_bias = true
        negative_bias = false

[ReadoutViaBvsDetuning]
    freq_vs = 2.79e9

    force_analysis= false
    force_measurement = false

    resolution_detuning = 0.0002

    extra_wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.6#1.1#2.5

    lockin_tc = 0.5#1#2

    [ReadoutViaBvsDetuning.detector]
        method = "MF" # [OU, MF]
        sigma = 1

        # OU settings
        max_kernel_size=11
        prominence=0.5
        detection_threshold=0.85

        # MF settings
        circularity_thresh = 3
        relative_length = 0.3
        adaptive_window = 7



[RabiAndEDSR]
    freq_vs = 2.79e9
    force_analysis= false
    force_measurement = false

    [RabiAndEDSR.Rabi]
        magnetic_field_window_multiplier = 2 # window is determined by EDSRCheck and multiplied with this number
        #resolution_magnet = 0.002
        n_px_magnet = 40

        resolution_burst_time = 1e-9

        min_burst_time = 0
        max_burst_time = 45e-9
        dead_burst_time = 10e-9



        extra_wait_time_slow_axis = 0.5
        wait_time_fast_axis = 2.5

        lockin_tc = 2

    [RabiAndEDSR.EDSR]
        min_magnetic_field = 0
        max_magnetic_field = 0.5
        resolution_magnet = 0.01

        min_freq_vs = 1.5e9
        max_freq_vs = 3.5e9

        resolution_freq = 0.5e8

        extra_wait_time_slow_axis = 2
        wait_time_fast_axis = 1.1#2.5

        lockin_tc = 1#2

[EDSRline]
    force_analysis= false
    force_measurement = false

    min_magnetic_field = 0.0
    max_magnetic_field = 0.5
    resolution_magnet = 0.005#01

    min_freq_vs = 2e9
    max_freq_vs = 3e9

    resolution_freq = 0.5e8

    extra_wait_time_slow_axis = 4
    wait_time_fast_axis = 1.1#2.5

    lockin_tc = 1#2

    sigma = 1

    circularity_thresh = 3
    relative_length = 0.3
    adaptive_window = 7

[Rabi]
    force_analysis= false
    force_measurement = false

    magnetic_field_window_multiplier = 2 # window is determined by EDSRCheck and multiplied with this number
    resolution_magnet = 0.00075
    n_px_magnet = 40

    resolution_burst_time = 1e-9

    min_burst_time = 0
    max_burst_time = 45e-9
    dead_burst_time = 10e-9



    extra_wait_time_slow_axis = 6
    wait_time_fast_axis = 2.5

    lockin_tc = 2

[RabiOscillations]
    force_analysis= false
    force_measurement = false

    resolution_burst_time = 1e-9

    min_burst_time = 0
    max_burst_time = 60e-9
    dead_burst_time = 10e-9

    lockin_tc = 2

    n_repetitions = 5


[EDSRCheck]
    freq_vs = 2.79e9

    magnetic_field_window = 0.1
    resolution_magnet = 0.001

    wait_time = 2.5

    lockin_tc = 2


    prominence = 0.9
    sigma = 1
    force_analysis= false
    force_measurement = false

    peak_offset_tolerance = 0.025
[EDSRCheck.switch_check_scan]
    resolution = 0.0015
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.051
[ReadoutOptim]
    magnetic_field = 0.1
    resolution = 0.00075
    wait_time_slow_axis = 0.5
    wait_time_fast_axis = 0.0777
    force_analysis = false
    force_measurement = false
    burst_time = 4e-9
    in_depth_search = false
    lockin_tc = 1
    padding = 0.005
    segmentation_upscaling_res = 2
    relative_min_area = 0.001
    thr_method = 'triangle'

    seeding = 15
    number_of_candidates = 3

[ReadoutOptim.score_config]
    name = "entropy"
    kwargs.rescale = true
# can use prominence instead
[ReadoutOptim.optim_pulse_params]
    freq_vs.minimum = 2.6e9
    freq_vs.maximum = 2.9e9
    burst_time_ns.minimum = 2
    burst_time_ns.maximum = 16


[ReadoutOptim.invert_current]
    positive_bias = true
    negative_bias = false

[ReadoutOptim.optimization_kwargs]
    iterations = 30

[ReadoutOptim.magnetic_field_scan_config]
    measure = ["X", "Y"]
    scan_kwargs.measurement_name = "readout_optim"

    [ReadoutOptim.magnetic_field_scan_config.domain]
        field_setpoint.start = 0.0#4
        field_setpoint.stop = 0.4

        field_setpoint.num_points = 300
        field_setpoint.delay = 1

# 100 mT per minute, 1.66mT/s
